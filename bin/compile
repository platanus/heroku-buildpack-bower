#!/usr/bin/env bash

set -e

status() {
  echo "-----> $*"
}

build_dir=$1
cache_dir=$2

echo $cache_dir

# TODO: assuming this buildpack is run after the Node buildpack using multi
# for now.
node_dir=$build_dir/vendor/node

mkdir -p $cache_dir/bower/cache

ls -R $cache_dir/bower/cache

if [ -d $cache_dir/bower/app ]; then
    cp -r $cache_dir/bower/app $node_dir/lib/node_modules/bower
else
    status "Installing Bower."
    $node_dir/bin/npm -g install bower
    cp -r $node_dir/lib/node_modules/bower $cache_dir/bower/app
fi

status "Installing Bower dependencies."
PATH=$PATH:$node_dir/bin
$build_dir/vendor/node/lib/node_modules/bower/bin/bower --config.cwd=$build_dir --config.storage.packages=$cache_dir/bower/cache/packages --config.storage.registry=$cache_dir/bower/cache/registry install
